[{
  "kpi_id": "string",
  "name": "string",
  "description": "string",

  "frontend_inputs": {
    "required": ["time_range", "company"],
    "optional": ["granularity", "dimensions", "filters"]
  },

  "dba_requirements": {
    "dataset_mode": "AGGREGATED | DETAIL",
    "required_columns": ["column1", "column2"]
  },

  "calculation": {
    "type": "SUM | AVG | COUNT | DERIVED",
    "formula": "expression using columns",
    "guard": "optional protection rule"
  },

  "format": {
    "type": "currency | percentage | number",
    "decimals": 2
  }
},
{
  
  "kpi_id": "sales_net",
  "name": "Ventas Netas",
  "description": "Total de ventas netas en el periodo seleccionado.",

  "frontend_inputs": {
    "required": ["time_range", "company"],
    "optional": ["granularity", "dimensions"]
  },
  "dba_requirements": {
    "dataset_mode": "AGGREGATED",
    "required_columns": ["date", "sales_net"]
  },
  "calculation": {
    "type": "SUM",
    "formula": "SUM(sales_net)"
  },
  "format": {
    "type": "currency",
    "decimals": 0
  }
},
{
    "kpi_id": "Margen_Retail",
    "name": "Margen Retail",
    "description": "(ValorVenta - CostoVenta) / Venta",
    "frontend_inputs": {
      "required": ["time_range", "company"],
      "optional": ["granularity", "dimensions", "filters"]
    },
    "dba_requirements": {
      "dataset_mode": "AGGREGATED",
      "required_columns": ["vr_vta_sin_iva_pesos", "costo_vta_pesos"]
    },
    "calculation": {
      "type": "DERIVED",
      "formula": "(SUM(vr_vta_sin_iva_pesos) - SUM(costo_vta_pesos)) / NULLIF(SUM(vr_vta_sin_iva_pesos),0)"
    },
    "format": {
      "type": "percentage",
      "decimals": 4
    }
},
{
    "kpi_id": "Porc_Desc",
    "name": "% Desc",
    "description": "(VentaDescuento / VentaSubtotal)",
    "frontend_inputs": {
      "required": ["time_range", "company"],
      "optional": ["granularity", "dimensions", "filters"]
    },
    "dba_requirements": {
      "dataset_mode": "AGGREGATED",
      "required_columns": ["descuentos_pesos", "vr_vta_sin_iva_pesos"]
    },
    "calculation": {
      "type": "DERIVED",
      "formula": "SUM(descuentos_pesos) / NULLIF(SUM(vr_vta_sin_iva_pesos),0)"
    },
    "format": {
      "type": "percentage",
      "decimals": 4
    }
},
{
    "kpi_id": "Margen_Mas_Porc_Desc",
    "name": "Margen + %Desc",
    "description": "Margen Retail + % Desc",
    "frontend_inputs": {
      "required": ["time_range", "company"],
      "optional": ["granularity", "dimensions", "filters"]
    },
    "dba_requirements": {
      "dataset_mode": "AGGREGATED",
      "required_columns": ["vr_vta_sin_iva_pesos", "costo_vta_pesos", "descuentos_pesos"]
    },
    "calculation": {
      "type": "DERIVED",
      "formula": "((SUM(vr_vta_sin_iva_pesos) - SUM(costo_vta_pesos)) / NULLIF(SUM(vr_vta_sin_iva_pesos),0)) + (SUM(descuentos_pesos) / NULLIF(SUM(vr_vta_sin_iva_pesos),0))"
    },
    "format": {
      "type": "percentage",
      "decimals": 4
    }
},
{
    "kpi_id": "VentaProyectada",
    "name": "VentaProyectada",
    "description": "Proyección mensual equivalente a (('Valor subtotal local'/15)*31). Generalizado: (Venta acumulada / día del mes) * días del mes.",
    "frontend_inputs": {
      "required": ["time_range", "company"],
      "optional": ["dimensions", "filters"]
    },
    "dba_requirements": {
      "dataset_mode": "AGGREGATED",
      "required_columns": ["vr_vta_sin_iva_pesos", "fecha_dcto"]
    },
    "calculation": {
      "type": "DERIVED",
      "formula": "(SUM(vr_vta_sin_iva_pesos) / NULLIF(DAY(MAX(fecha_dcto)),0)) * DAY(EOMONTH(MAX(fecha_dcto)))"
    },
    "format": { 
      "type": "currency", 
      "decimals": 0 }
  },
  {
    "kpi_id": "Cump_ppto_proy",
    "name": "Cumplimiento ppto_proyectado",
    "description": "Vta Proyectada / Ppto_Venta. (Ppto_Venta se toma de T_ppto_venta.valor_ppto).",
    "frontend_inputs": {
      "required": ["time_range", "company"],
      "optional": ["dimensions", "filters"]
    },
    "dba_requirements": {
      "dataset_mode": "AGGREGATED",
      "required_columns": ["vr_vta_sin_iva_pesos", "fecha_dcto", "valor_ppto", "fecha", "id_co", "sk_geografia"]
    },
    "calculation": {
      "type": "DERIVED",
      "formula": "((SUM(vr_vta_sin_iva_pesos) / NULLIF(DAY(MAX(fecha_dcto)),0)) * DAY(EOMONTH(MAX(fecha_dcto)))) / NULLIF(SUM(valor_ppto),0)"
    },
    "format": { 
    "type": "percentage",
    "decimals": 4 }
  },
  {
    "kpi_id": "Dif_Venta_proyectada",
    "name": "Diferencia de Venta_proyectada",
    "description": "Vta Proyectada - Ppto_Venta. (Ppto_Venta se toma de T_ppto_venta.valor_ppto).",
    "frontend_inputs": {
      "required": ["time_range", "company"],
      "optional": ["dimensions", "filters"]
    },
    "dba_requirements": {
      "dataset_mode": "AGGREGATED",
      "required_columns": ["vr_vta_sin_iva_pesos", "fecha_dcto", "valor_ppto", "fecha", "id_co", "sk_geografia"]
    },
    "calculation": {
      "type": "DERIVED",
      "formula": "((SUM(vr_vta_sin_iva_pesos) / NULLIF(DAY(MAX(fecha_dcto)),0)) * DAY(EOMONTH(MAX(fecha_dcto)))) - SUM(valor_ppto)"
    },
    "format": { 
    "type": "currency",
    "decimals": 0 }
  },
  {
    "kpi_id": "Cump_ppto",
    "name": "Cumplimiento del ppto",
    "description": "Valor subtotal local / Ppto_Venta. (Ppto_Venta se toma de T_ppto_venta.valor_ppto).",
    "frontend_inputs": {
      "required": ["time_range", "company"],
      "optional": ["dimensions", "filters"]
    },
    "dba_requirements": {
      "dataset_mode": "AGGREGATED",
      "required_columns": ["vr_vta_sin_iva_pesos", "fecha_dcto", "valor_ppto", "fecha", "id_co", "sk_geografia"]
    },
    "calculation": {
      "type": "DERIVED",
      "formula": "SUM(vr_vta_sin_iva_pesos) / NULLIF(SUM(valor_ppto),0)"
    },
    "format": { 
    "type": "percentage",
    "decimals": 4 }
  }

]